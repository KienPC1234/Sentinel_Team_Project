{% extends "base.html" %}
{% block title %}Tra c·ª©u b√°o c√°o c·ªßa t√¥i - ShieldCall VN{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-10 mt-16 space-y-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6" data-aos="fade-up">
        <div class="flex items-center gap-5">
            <div class="w-16 h-16 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center shadow-lg shadow-red-500/10">
                <i class="bi bi-flag-fill text-red-500 text-2xl"></i>
            </div>
            <div>
                <h1 class="text-3xl font-black text-white tracking-tight">B√°o c√°o c·ªßa t√¥i</h1>
                <p class="text-[10px] font-bold text-white/20 uppercase tracking-widest mt-1">Theo d√µi tr·∫°ng th√°i c√°c b√°o c√°o l·ª´a ƒë·∫£o b·∫°n ƒë√£ g·ª≠i</p>
            </div>
        </div>
        <a href="/report/" class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-red-500 text-black font-black text-xs uppercase tracking-widest hover:bg-red-400 transition-all shadow-lg shadow-red-500/20">
            <i class="bi bi-plus-lg"></i> G·ª≠i b√°o c√°o m·ªõi
        </a>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-aos="fade-up" data-aos-delay="100">
        <div class="liquid-card p-5 text-center space-y-2">
            <div class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center mx-auto">
                <i class="bi bi-file-earmark-text text-white/40"></i>
            </div>
            <p class="text-2xl font-black text-white">{{ stats.total }}</p>
            <p class="text-[9px] font-bold text-white/30 uppercase tracking-widest">T·ªïng b√°o c√°o</p>
        </div>
        <div class="liquid-card p-5 text-center space-y-2">
            <div class="w-10 h-10 rounded-xl bg-yellow-500/10 border border-yellow-500/20 flex items-center justify-center mx-auto">
                <i class="bi bi-clock text-yellow-500"></i>
            </div>
            <p class="text-2xl font-black text-yellow-400">{{ stats.pending }}</p>
            <p class="text-[9px] font-bold text-white/30 uppercase tracking-widest">Ch·ªù duy·ªát</p>
        </div>
        <div class="liquid-card p-5 text-center space-y-2">
            <div class="w-10 h-10 rounded-xl bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center mx-auto">
                <i class="bi bi-check-circle text-emerald-400"></i>
            </div>
            <p class="text-2xl font-black text-emerald-400">{{ stats.approved }}</p>
            <p class="text-[9px] font-bold text-white/30 uppercase tracking-widest">ƒê√£ duy·ªát</p>
        </div>
        <div class="liquid-card p-5 text-center space-y-2">
            <div class="w-10 h-10 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center justify-center mx-auto">
                <i class="bi bi-x-circle text-red-400"></i>
            </div>
            <p class="text-2xl font-black text-red-400">{{ stats.rejected }}</p>
            <p class="text-[9px] font-bold text-white/30 uppercase tracking-widest">T·ª´ ch·ªëi</p>
        </div>
    </div>

    <!-- Filter Tabs -->
    <div class="flex items-center gap-2 flex-wrap" data-aos="fade-up" data-aos-delay="150">
        <a href="?" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all border {% if not status_filter %}bg-white/10 text-white border-white/20{% else %}text-white/40 border-transparent hover:bg-white/5{% endif %}">
            T·∫•t c·∫£
        </a>
        <a href="?status=pending" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all border {% if status_filter == 'pending' %}bg-yellow-500/10 text-yellow-400 border-yellow-500/20{% else %}text-white/40 border-transparent hover:bg-white/5{% endif %}">
            <i class="bi bi-clock mr-1"></i> Ch·ªù duy·ªát
        </a>
        <a href="?status=approved" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all border {% if status_filter == 'approved' %}bg-emerald-500/10 text-emerald-400 border-emerald-500/20{% else %}text-white/40 border-transparent hover:bg-white/5{% endif %}">
            <i class="bi bi-check-circle mr-1"></i> ƒê√£ duy·ªát
        </a>
        <a href="?status=rejected" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all border {% if status_filter == 'rejected' %}bg-red-500/10 text-red-400 border-red-500/20{% else %}text-white/40 border-transparent hover:bg-white/5{% endif %}">
            <i class="bi bi-x-circle mr-1"></i> T·ª´ ch·ªëi
        </a>
    </div>

    <!-- Reports List -->
    <div class="space-y-4" data-aos="fade-up" data-aos-delay="200">
        {% for report in reports %}
        <div class="liquid-card p-6 hover:border-white/15 transition-all group" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:'50' }}">
            <div class="flex flex-col lg:flex-row lg:items-center gap-4">
                <!-- Left: Report Info -->
                <div class="flex-1 min-w-0 space-y-3">
                    <div class="flex items-center gap-3 flex-wrap">
                        <span class="text-[9px] font-black uppercase tracking-widest px-2 py-1 rounded-lg border
                            {% if report.status == 'pending' %}bg-yellow-500/10 text-yellow-500 border-yellow-500/20
                            {% elif report.status == 'approved' %}bg-emerald-500/10 text-emerald-400 border-emerald-500/20
                            {% else %}bg-red-500/10 text-red-400 border-red-500/20{% endif %}">
                            {% if report.status == 'pending' %}<i class="bi bi-clock mr-1"></i>Ch·ªù duy·ªát
                            {% elif report.status == 'approved' %}<i class="bi bi-check-circle mr-1"></i>ƒê√£ duy·ªát
                            {% else %}<i class="bi bi-x-circle mr-1"></i>T·ª´ ch·ªëi{% endif %}
                        </span>
                        <span class="text-[8px] font-black text-white/20 uppercase tracking-widest px-2 py-1 bg-white/5 rounded-lg border border-white/10">
                            {% if report.target_type == 'phone' %}üìû{% elif report.target_type == 'domain' %}üåê{% elif report.target_type == 'account' %}üè¶{% elif report.target_type == 'email' %}üìß{% else %}üí¨{% endif %}
                            {{ report.get_target_type_display|default:report.target_type }}
                        </span>
                        <span class="text-[9px] font-bold text-white/20">{{ report.created_at|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div class="text-lg font-black text-white tracking-tight">{{ report.target_value }}</div>
                    <p class="text-xs text-white/40 line-clamp-2 leading-relaxed">{{ report.description|striptags|truncatechars:200 }}</p>
                    
                    {% if report.get_scam_type_display %}
                    <div class="flex items-center gap-2">
                        <span class="text-[9px] font-bold text-cyan-400/60 uppercase tracking-widest">{{ report.get_scam_type_display }}</span>
                        <span class="text-[8px] font-bold px-2 py-0.5 rounded
                            {% if report.severity == 'low' %}bg-green-500/10 text-green-400
                            {% elif report.severity == 'medium' %}bg-yellow-500/10 text-yellow-400
                            {% elif report.severity == 'high' %}bg-red-500/10 text-red-400
                            {% else %}bg-red-600/20 text-red-500{% endif %}">
                            {{ report.severity|upper }}
                        </span>
                    </div>
                    {% endif %}
                </div>

                <!-- Right: Evidence & AI -->
                <div class="flex items-center gap-3 shrink-0">
                    {% if report.evidence_file %}
                    <div class="w-16 h-16 rounded-xl overflow-hidden border border-white/10 cursor-zoom-in" 
                         onclick="Swal.fire({imageUrl: '{{ report.evidence_file.url }}', background: '#000', showConfirmButton: false, customClass: {popup: 'rounded-3xl border border-white/10'}})">
                        <img src="{{ report.evidence_file.url }}" class="w-full h-full object-cover">
                    </div>
                    {% endif %}
                    {% for img in report.evidence_images.all %}
                    <div class="w-16 h-16 rounded-xl overflow-hidden border border-white/10 cursor-zoom-in"
                         onclick="Swal.fire({imageUrl: '{{ img.image.url }}', background: '#000', showConfirmButton: false, customClass: {popup: 'rounded-3xl border border-white/10'}})">
                        <img src="{{ img.image.url }}" class="w-full h-full object-cover">
                    </div>
                    {% endfor %}

                    {% if report.ai_analysis and report.ai_analysis != '{}' %}
                    <div class="w-12 h-12 rounded-xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center" title="AI ƒë√£ ph√¢n t√≠ch">
                        <i class="bi bi-robot text-purple-400"></i>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if report.moderation_note %}
            <div class="mt-4 p-4 rounded-xl bg-white/[0.02] border border-white/5">
                <p class="text-[9px] font-black text-white/20 uppercase tracking-widest mb-1">Ghi ch√∫ ki·ªÉm duy·ªát</p>
                <p class="text-xs text-white/60">{{ report.moderation_note }}</p>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <div class="liquid-card p-16 text-center space-y-4">
            <div class="w-20 h-20 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center mx-auto">
                <i class="bi bi-inbox text-3xl text-white/10"></i>
            </div>
            <p class="text-white/20 font-bold">B·∫°n ch∆∞a g·ª≠i b√°o c√°o n√†o{% if status_filter %} v·ªõi tr·∫°ng th√°i n√†y{% endif %}.</p>
            <a href="/report/" class="inline-flex items-center gap-2 text-cyan-400 text-sm font-bold hover:text-white transition-colors">
                <i class="bi bi-plus-circle"></i> G·ª≠i b√°o c√°o ƒë·∫ßu ti√™n
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
