{% extends "base.html" %}
{% load static %}

{% block title %}Quản lý Người dùng - ShieldCall VN Admin{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-10 mt-16 max-w-6xl">
    <div class="flex items-center justify-between mb-12">
        <div class="flex items-center gap-6">
            <a href="{% url 'admin-dashboard' %}" class="w-14 h-14 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-white/40 hover:text-cyan-400 hover:border-cyan-500/30 transition-all shadow-lg">
                <i class="bi bi-chevron-left text-2xl"></i>
            </a>
            <div>
                <h1 class="text-3xl font-black text-white tracking-tight">Người dùng & Phân quyền</h1>
                <p class="text-[10px] font-bold text-white/20 uppercase tracking-widest mt-1">Quản lý tài khoản và quyền hạn hệ thống</p>
            </div>
        </div>
    </div>

    {% if messages %}
    <div class="mb-10 space-y-3">
        {% for message in messages %}
        <div class="p-5 rounded-2xl flex items-center gap-4 animate-in fade-in slide-in-from-top-4 duration-500
            {% if message.tags == 'success' %}bg-emerald-500/10 text-emerald-400 border border-emerald-500/20
            {% else %}bg-rose-500/10 text-rose-400 border border-rose-500/20{% endif %}">
            <i class="bi {% if message.tags == 'success' %}bi-check-circle-fill{% else %}bi-exclamation-triangle-fill{% endif %} text-lg"></i>
            <span class="text-xs font-black uppercase tracking-widest">{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="p-1 rounded-[3rem] bg-slate-900/40 border border-white/5 backdrop-blur-xl overflow-hidden shadow-2xl">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-separate border-spacing-0">
                <thead>
                    <tr class="bg-white/[0.02]">
                        <th class="px-8 py-6 text-[10px] font-black text-white/40 uppercase tracking-widest border-b border-white/5">Người dùng</th>
                        <th class="px-8 py-6 text-[10px] font-black text-white/40 uppercase tracking-widest border-b border-white/5">Vai trò</th>
                        <th class="px-8 py-6 text-[10px] font-black text-white/40 uppercase tracking-widest border-b border-white/5">Điểm Uy tín</th>
                        <th class="px-8 py-6 text-[10px] font-black text-white/40 uppercase tracking-widest border-b border-white/5">Trạng thái</th>
                        <th class="px-8 py-6 text-[10px] font-black text-white/40 uppercase tracking-widest border-b border-white/5 text-right">Hành động</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/[0.02]">
                    {% for u in users %}
                    <tr class="group hover:bg-white/[0.03] transition-all duration-300">
                        <td class="px-8 py-7">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-[1.25rem] bg-white/5 border border-white/10 flex items-center justify-center text-white/20 overflow-hidden relative group/avatar">
                                    {% if u.profile.avatar %}
                                    <img src="{{ u.profile.avatar.url }}" class="w-full h-full object-cover group-hover/avatar:scale-110 transition-transform duration-700">
                                    {% else %}
                                    <i class="bi bi-person-fill text-2xl"></i>
                                    {% endif %}
                                    <div class="absolute inset-0 bg-cyan-500/20 opacity-0 group-hover/avatar:opacity-100 transition-opacity"></div>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-sm font-black text-white tracking-tight">{{ u.username }}</span>
                                    <span class="text-[10px] font-bold text-white/30">{{ u.email }}</span>
                                </div>
                            </div>
                        </td>
                        <td class="px-8 py-7">
                            {% if u.profile.is_super_admin %}
                            <span class="px-3 py-1 rounded-lg bg-rose-500/10 text-rose-500 text-[9px] font-black uppercase border border-rose-500/20 tracking-widest">Super Admin</span>
                            {% elif u.is_staff %}
                            <span class="px-3 py-1 rounded-lg bg-cyan-500/10 text-cyan-400 text-[9px] font-black uppercase border border-cyan-500/20 tracking-widest">Administrator</span>
                            {% else %}
                            <span class="px-3 py-1 rounded-lg bg-white/5 text-white/30 text-[9px] font-black uppercase border border-white/10 tracking-widest">Member</span>
                            {% endif %}
                        </td>
                        <td class="px-8 py-7">
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-black text-white/80">{{ u.profile.rank_points }}</span>
                                <i class="bi bi-star-fill text-[10px] text-yellow-500/50"></i>
                            </div>
                        </td>
                        <td class="px-8 py-7">
                            {% if u.is_active %}
                            <div class="flex items-center gap-2 text-emerald-500">
                                <div class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"></div>
                                <span class="text-[10px] font-black uppercase tracking-widest">Hoạt động</span>
                            </div>
                            {% else %}
                            <div class="flex items-center gap-2 text-white/20">
                                <div class="w-2 h-2 rounded-full bg-white/10"></div>
                                <span class="text-[10px] font-black uppercase tracking-widest italic">Vô hiệu hóa</span>
                            </div>
                            {% endif %}
                        </td>
                        <td class="px-8 py-7">
                            <div class="flex justify-end gap-3 opacity-0 group-hover:opacity-100 transition-all translate-x-4 group-hover:translate-x-0">
                                <a href="{% url 'admin-toggle-role' u.id %}" class="h-9 px-4 rounded-xl bg-white/5 text-white/60 text-[10px] font-black uppercase tracking-widest border border-white/10 hover:border-cyan-500/30 hover:text-cyan-400 hover:bg-cyan-500/5 transition-all flex items-center justify-center">
                                    {% if u.is_staff %}Gỡ Quyền{% else %}Cấp Quyền{% endif %}
                                </a>
                                <button class="w-9 h-9 rounded-xl bg-rose-500/10 text-rose-500 flex items-center justify-center hover:bg-rose-500 hover:text-white transition-all border border-rose-500/20">
                                    <i class="bi bi-slash-circle"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="px-8 py-20 text-center text-white/20 font-bold tracking-widest uppercase text-xs italic">No participants found in the system grid.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
