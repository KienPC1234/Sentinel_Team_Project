; ═══════════════════════════════════════════════════
; ShieldCall VN — Supervisor Configuration
; ═══════════════════════════════════════════════════
; Cách sử dụng:
;   sudo cp /data/PKV_TEAM/supervisor_pkv.conf /etc/supervisor/conf.d/pkv.conf
;   sudo supervisorctl reread
;   sudo supervisorctl update
;   sudo supervisorctl start pkv:*
;
; Xem trạng thái:
;   sudo supervisorctl status pkv:*
;
; Restart tất cả:
;   sudo supervisorctl restart pkv:*

[group:pkv]
programs=pkv-web,pkv-celery

; ─── Daphne ASGI Server (Django + WebSocket) ───
[program:pkv-web]
command=/data/miniconda3/envs/pkv/bin/python -m daphne -b 0.0.0.0 -p 8001 --proxy-headers PKV.asgi:application
directory=/data/PKV_TEAM
environment=DJANGO_SETTINGS_MODULE="PKV.settings",PYTHONUNBUFFERED="1"
user=root
autostart=true
autorestart=true
startsecs=5
startretries=3
stopwaitsecs=30
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/pkv-web.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5

; ─── Celery Worker ───
[program:pkv-celery]
command=/data/miniconda3/envs/pkv/bin/python -m celery -A PKV worker --loglevel=info --concurrency=4 -Q celery,default
directory=/data/PKV_TEAM
environment=DJANGO_SETTINGS_MODULE="PKV.settings",PYTHONUNBUFFERED="1"
user=root
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=60
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/pkv-celery.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
